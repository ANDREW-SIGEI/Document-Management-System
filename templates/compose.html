{% extends 'base.html' %}

{% block title %}Compose Document - Document Management System{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">{{ 'New Incoming Document' if doc_type == 'Incoming' else 'New Outgoing Document' }}</h4>
                </div>
                <div class="card-body">
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                                    {{ message }}
                                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <form action="{{ url_for('compose') }}" method="POST" enctype="multipart/form-data">
                        <!-- Document Type Selection -->
                        <div class="mb-4">
                            <div class="form-group">
                                <label for="doc_type" class="form-label">Document Direction</label>
                                <div class="btn-group w-100" role="group">
                                    <input type="radio" class="btn-check" name="doc_type" id="type_incoming" value="Incoming" autocomplete="off" {% if doc_type == 'Incoming' %}checked{% endif %}>
                                    <label class="btn btn-outline-primary" for="type_incoming">
                                        <i class="fas fa-inbox me-2"></i>Incoming Document
                                    </label>
                                    
                                    <input type="radio" class="btn-check" name="doc_type" id="type_outgoing" value="Outgoing" autocomplete="off" {% if doc_type == 'Outgoing' %}checked{% endif %}>
                                    <label class="btn btn-outline-primary" for="type_outgoing">
                                        <i class="fas fa-paper-plane me-2"></i>Outgoing Document
                                    </label>
                                </div>
                                <div class="form-text">Select whether this is an incoming or outgoing document</div>
                            </div>
                        </div>

                        <!-- Document Upload Section -->
                        <div class="mb-4">
                            <div class="form-group">
                                <label for="document_file" class="form-label">Document File</label>
                                <input type="file" class="form-control" id="document_file" name="document_file" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt,.jpg,.jpeg,.png">
                                <div class="form-text">Upload the document file (PDF, Word, Excel, etc.)</div>
                            </div>
                        </div>

                        <!-- Document Details Section -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="title" class="form-label">Document Title <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="title" name="title" placeholder="Enter document title" value="{{ form_data.title if form_data else '' }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="date_of_letter" class="form-label">Date of Letter</label>
                                    <input type="date" class="form-control" id="date_of_letter" name="date_of_letter" value="{{ form_data.date_of_letter if form_data else '' }}">
                                </div>
                            </div>
                        </div>

                        <!-- Sender/Recipient Section -->
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="sender" class="form-label">From (Sender) <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="sender" name="sender" placeholder="Department or individual name" value="{{ form_data.sender if form_data else '' }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="recipient" class="form-label">To (Recipient) <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="recipient" name="recipient" placeholder="Department or individual name" value="{{ form_data.recipient if form_data else '' }}" required>
                                </div>
                            </div>
                        </div>

                        <!-- Document Content Section -->
                        <div class="mb-4">
                            <div class="form-group">
                                <label for="details" class="form-label">Document Details</label>
                                <textarea class="form-control" id="details" name="details" rows="4" placeholder="Enter document details or content summary">{{ form_data.details if form_data else '' }}</textarea>
                            </div>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="required_action" class="form-label">Required Action</label>
                                    <select class="form-select" id="required_action" name="required_action">
                                        <option value="" selected disabled>Select required action</option>
                                        <option value="For Information">For Information</option>
                                        <option value="For Review">For Review</option>
                                        <option value="For Approval">For Approval</option>
                                        <option value="For Comment">For Comment</option>
                                        <option value="For Action">For Action</option>
                                        <option value="For Filing">For Filing</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="priority" class="form-label">Priority</label>
                                    <select class="form-select" id="priority" name="priority">
                                        <option value="Normal" {% if (form_data and form_data.priority == 'Normal') or not form_data %}selected{% endif %}>Normal</option>
                                        <option value="Priority" {% if form_data and form_data.priority == 'Priority' %}selected{% endif %}>Priority</option>
                                        <option value="Urgent" {% if form_data and form_data.priority == 'Urgent' %}selected{% endif %}>Urgent</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="mt-4 text-end">
                            <button type="reset" class="btn btn-outline-secondary me-2">
                                <i class="fas fa-undo me-1"></i> Clear Form
                            </button>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-1"></i> Save Document
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle between incoming and outgoing document types
        const typeIncoming = document.getElementById('type_incoming');
        const typeOutgoing = document.getElementById('type_outgoing');
        
        function updateFormForType() {
            if (typeIncoming.checked) {
                document.title = 'New Incoming Document - Document Management System';
                document.querySelector('.card-header h4').textContent = 'New Incoming Document';
            } else {
                document.title = 'New Outgoing Document - Document Management System';
                document.querySelector('.card-header h4').textContent = 'New Outgoing Document';
            }
        }
        
        typeIncoming.addEventListener('change', updateFormForType);
        typeOutgoing.addEventListener('change', updateFormForType);
    });
</script>
{% endblock %} 